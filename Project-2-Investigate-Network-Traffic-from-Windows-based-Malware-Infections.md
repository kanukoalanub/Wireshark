# Investigating Network Traffic from Windows based Malware Infections

## Introduction

In this project, we cover how to use Wireshark to investigate network traffic from Windows based malware infections.

## Lab Set-up and Tools

1. **Tool**: Wireshark v4.2.6
2. **Sample PCAP File**: Download a sample PCAP file containing malware traffic for analysis.

## Exercises

### Exercise 1: One method to Identify Host name through DHCP Traffic

#### Steps

1. Open Wireshark.
2. Go to "File" > "Open" and select the sample PCAP file you downloaded.
3. The file will load, and the captured traffic will be displayed.
4. Filter the file by typing DHCP.

#### Expected Output

- The sample PCAP file containing DHCP traffic loaded in Wireshark.
- That displays host name under the Dynamic Host Configuration Protocol details section in the Frames detail section.

![Screenshot 2024-08-04 012143](https://github.com/user-attachments/assets/327704b7-aa34-4213-abe5-0a4d20a22d8f)

### Exercise 2: Identify Windows/macOS Hosts name through NBNS Traffic

#### Steps

1. Open Wireshark.
2. Go to "File" > "Open" and select the sample PCAP file you downloaded.
3. The file will load, and the captured traffic will be displayed.
4. Filter the file by typing NBNS.

#### Expected Output

- The sample PCAP file containing NBNS traffic loaded in Wireshark.
- That displays host name in the Ethernet II details section in the Frames detail section.

![Screenshot 2024-08-04 015444](https://github.com/user-attachments/assets/425fafd3-dd49-4c1f-80b0-3da6c8f8fc99)

### Exercise 3: Identify OS and Web browser information in un encrypted HTTP headers

#### Steps

1. Open Wireshark.
2. Go to "File" > "Open" and select the sample PCAP file you downloaded.
3. The file will load, and the captured traffic will be displayed.
4. select GET HTTP frame, right click on it and go to Flow>TCP Stream
5. As seen in the screen shot below, **this traffic was caused by using Safari web browser, Mac OS (Mac OS X) and MacBook.**
   
#### Expected Output

- Detailed information about a suspicious packet analyzed.

- ![image](https://github.com/user-attachments/assets/8e7c1020-5381-4732-a018-3e9309fbe1da)

6. As seen in the screen shot below, **this traffic was caused by using newer chromium based Microsoft Edge Web browser, Windows NT 10.0 is for Windows 10           host.**
 
- ![image](https://github.com/user-attachments/assets/54881e41-a5b2-4c04-bcc1-7544b033b33e)

  7. Please note that Microsoft Edge and Google Chrome browsers contains strings for other browsers types like Safari for compatibility reasons.
 
  8. As seen in the screen shot below, **this traffic was caused by using chrome browser, and Android host.**
      
  9. Android hosts include a model name or model number in the User-Agent line.
![image](https://github.com/user-attachments/assets/352c6d93-0e53-4741-aa33-a97dd7c1173e)


### Exercise 4: Identify Windows User Account Name from a window client logging into Active directory environment

#### Steps

1. Open Wireshark.
2. Go to "File" > "Open" and select the sample PCAP file you downloaded.
3. The file will load, and the captured traffic will be displayed.
4. By filtering with Kerberos.CNameString the results will have TCP segments from Kerberos traffic that will reveal the host name and also reveal the windows user    account name. 
   Kerberos>as-req>req-body>cname>cname-string
   Which in this case is desktop-c2y6u4a$ (right click on cname-string and apply as column 
   This PCAP consists of Rakesh.modi logging into windows 10 host in an Active directory environment and then viewing a web page from redhill.net.au in the google    chrome web browser. CNameString column is used whenever we are trying to determine a windows user account name.


#### Expected Output
- windows user account name is visible under cname>cname-string as seen in the screen shot below

![image](https://github.com/user-attachments/assets/8119e251-f7e8-4579-a182-d677a0c512d4)

Sometimes when investigating suspicious traffic, we may not find the host name in DHCP, NBNS, Kerberos Traffic. If that happens you might find the host name in SMB traffic.

![image](https://github.com/user-attachments/assets/3b714aba-46e4-46e3-a4b0-bb1a7b23af3c)

